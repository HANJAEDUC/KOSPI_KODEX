# KOSPI_KODEX 데이터 수동 업데이트 가이드

이 파일은 자동 업데이트(Cron)가 실패하거나, 원하는 시간에 직접 최신 데이터를 가져오고 싶을 때 사용하는 방법입니다.

## 1. 수동 업데이트 실행 (백그라운드)

터미널을 열고 `KOSPI_KODEX` 프로젝트 최상위 폴더(`/Users/jaeduchan/Documents/jhan/antigravity/KOSPI_KODEX`)에서 다음 명령어를 실행하세요.

```bash
nohup ./cron_update.sh > manual_update.log 2>&1 &
```

- `nohup`과 `&`를 붙이면 백그라운드에서 실행되므로, 터미널 창을 닫아도 수집이 중단되지 않습니다.
- 전체 종목 수집에는 **약 10~20분** 정도 소요될 수 있습니다.

## 2. 수집 진행 상황 확인

데이터가 잘 받아지고 있는지 실시간으로 확인하려면 아래 명령어를 입력하세요.

```bash
tail -f collector.log
```

- 내용을 계속 띄워주며 업데이트되는 것을 볼 수 있습니다.
- 보기 모드를 종료하려면 키보드의 `Ctrl + C`를 누르시면 됩니다.

## 3. 완료 확인

수집과 분석이 모두 끝나면 `cron_update.sh` 스크립트가 알아서 GitHub에 저장(push)까지 완료해 줍니다. 전체 작업이 잘 끝났는지 최종 확인하려면 로그 파일의 마지막을 확인하세요.

```bash
cat manual_update.log
```

아래와 같이 **"✅ 업데이트 완료"** 메시지가 보이면 모든 데이터 갱신 및 Vercel 프론트엔드 연동이 끝난 것입니다!

```text
--------------------------------------------------
📅 실행 일시: Thu Feb 26 05:45:23 CET 2026
🚀 데이터 업데이트 시작...
✅ 업데이트 완료: Thu Feb 26 05:53:50 CET 2026
--------------------------------------------------
```

---

## [추가] 4. 자동 업데이트 (Cron) 설정 및 권한 부여 방법

이 시스템은 기본적으로 매일 아침 06:30(KST)에 동작하도록 `crontab`에 등록되어 있습니다. 자동 실행이 안 될 경우, 대부분 맥(macOS)의 보안 정책상 권한이 막혀 있기 때문입니다.

### 4-1. Crontab 등록 확인 및 설정
먼저 크론탭에 정상적으로 작업이 등록되어 있는지 확인합니다.
1. 터미널을 열고 `crontab -e` 명령어를 입력합니다.
2. 아래와 같이 한국 시간(KST) 06:30에 맞춰진 스케줄이 들어가 있는지 확인합니다. (독일 뮌헨 시간 기준으로는 22:30 이므로 `30 22`로 되어 있어야 합니다)
   ```bash
   30 22 * * * /Users/jaeduchan/Documents/jhan/antigravity/KOSPI_KODEX/cron_update.sh >> /Users/jaeduchan/Documents/jhan/antigravity/KOSPI_KODEX/cron.log 2>&1
   ```
3. 키보드의 `i`를 눌러 수정 모드로 진입한 뒤 내용을 저장하려면, `esc` 키를 누르고 `:wq`를 입력한 뒤 엔터를 누릅니다.

### 4-2. macOS [전체 디스크 접근 권한] 부여 (필수)
`cron.log`에 `Operation not permitted` 오류가 난다면 스케줄러가 백그라운드에서 폴더에 접근하지 못하는 상태입니다. 권한을 부여해야 합니다.
1. 맥의 화면 상단 **[(애플 로고)]** 클릭 -> **[시스템 설정]** 에 들어갑니다.
2. 왼쪽 메뉴에서 **[개인정보 보호 및 보안]** 섹션을 클릭합니다.
3. 오른쪽 리스트 중 **[전체 디스크 접근 권한]** 을 찾아 클릭합니다.
4. 리스트에서 **`cron`** 혹은 터미널(`Terminal`)을 찾아 토글 스위치를 활성화(파란색)해 줍니다.
   - *팁: `cron`이 목록에 보이지 않는다면 화면 아래 `+` 버튼을 누릅니다. 이후 키보드 단축키 `Command + Shift + G`를 누른 뒤 `/usr/sbin/cron` 경로를 입력하여 cron 실행 파일을 직접 찾아 추가해 줍니다.*
5. 권한이 정상 부여되면 매일 자동으로 데이터 수집 및 GitHub Push가 진행됩니다!
